<!DOCTYPE html>
<html lang="en">
<% include parts/head %>
<body>
<% include parts/header %>
<% include parts/search-bar %>
<div class="homeContainer">
    <div class="gw-jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4">Self-managed products</h1>
        </div>
    </div>
    <div class="docPanelContainer container">
        <div class="row">
            <%  let groups = docs.reduce((r, a) => {
                    if (a.metadata.platform === 'Self-managed') {
                        r[a.metadata.category] = [...r[a.metadata.category] || [], a];
                    }
                    return r;
                }, {});
                const groupArray = Object.entries(groups);
                groupArray.forEach(group => {
                    const groupName = group[0];
                    const groupItems = group[1]; -%>
                    <div class="col-md">
                        <div class="card border-light mb-3" style="max-width: 18rem;">
                            <h4 class="card-header bg-transparent"><%= groupName %></h4>
                            <div class="card-body">
                                <div class="card-text">
                                    <%  const products = groupItems.reduce((r, a) => {
                                           r[a.metadata.product] = [...r[a.metadata.product] || [], a];
                                           return r;
                                        }, {});
                                        const productArray = Object.entries(products);
                                        productArray.forEach(product => {
                                            const productTitle = product[0].trim();
                                            const productReleases = product[1];
                                            const versionsInProductGroup = productReleases.map(item => {
                                                return parseInt(item.metadata.version.replace(/\./g, ''));
                                            });
                                            const latestVersion = Math.max(...versionsInProductGroup);
                                            console.log('VERSIONS IN GROUP', versionsInProductGroup);

                                            const doc = productReleases.find(item => parseInt(item.metadata.version.replace(/\./g, '')) === latestVersion);
                                            -%>
                                            <div>
                                                <span class="docPanelLink"><a
                                                    href="<%= doc.url %>"><%= doc.title %></a></span>
                                            </div>
                                    <% }) -%>
                                </div>
                            </div>
                        </div>
                    </div>
            <% }) -%>
        </div>
        <div class="row">
            <div class="col-md">
                <a href="/self-managed-all-releases" class="btn-sm btn-dark" role="button">See all releases</a>
            </div>
        </div>
    </div>
</div>
<% include parts/footer %>
</body>
</html>
