apiVersion: apps/v1
kind: Deployment
metadata:
  name: docportal-app-deployment
  namespace: ${NAMESPACE}
spec:
  selector:
    matchLabels:
      app: docportal-app
  replicas: 1
  template:
    metadata:
      labels:
        app: docportal-app
      annotations:
        iam.amazonaws.com/role: arn:aws:iam::627188849628:role/aws_gwre-ccs-dev_tenant_doctools_developer
    spec:
      containers:
        - name: docportal
          image: artifactory.guidewire.com/doctools-docker-dev/docportal:${TAG_VERSION}
          command: [\"/bin/sh\", \"-c\"]
          args: [\"until wget -qO- http://localhost:15000/server_info | grep '\\\"state\\\": \\\"LIVE\\\"'; do echo 'Waiting for Istio sidecar'; sleep 1 ; done ; echo 'istio sidecar available'; npm start\"]
          imagePullPolicy: Always
          ports:
            - containerPort: 8081
          livenessProbe:
            httpGet:
              path: /alive
              port: 8081
            initialDelaySeconds: 60
            periodSeconds: 45
          readinessProbe:
            httpGet:
              path: /alive
              port: 8081
            initialDelaySeconds: 150
            periodSeconds: 45
          env:
            - name: REFRESH_IMAGE
              value: 'BUILD_TIME'
            - name: OKTA_DOMAIN
              value: ${OKTA_DOMAIN}
            - name: OKTA_CLIENT_ID
              value: ${OKTA_CLIENT_ID}
            - name: OKTA_CLIENT_SECRET
              value: ${OKTA_CLIENT_SECRET}
            - name: APP_BASE_URL
              value: https://docs.${DEPLOY_ENV}.ccs.guidewire.net
            - name: SESSION_KEY
              value: ${SESSION_KEY}
            - name: ELASTIC_SEARCH_URL
              value: http://docsearch-${DEPLOY_ENV}.doctools:9200
            - name: DOC_S3_URL
              value: https://ditaot.internal.${DEPLOY_ENV}.ccs.guidewire.net
            - name: PARTNERS_LOGIN_URL
              value: ${PARTNERS_LOGIN_URL}
            - name: PARTNERS_LOGIN_CERT
              value: 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
            - name: PARTNERS_LOGIN_SERVICE_PROVIDER_ENTITY_ID
              value: https://docs.${DEPLOY_ENV}.ccs.guidewire.net/partners-login
            - name: CUSTOMERS_LOGIN_URL
              value: ${CUSTOMERS_LOGIN_URL}
            - name: CUSTOMERS_LOGIN_CERT
              value: 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
            - name: CUSTOMERS_LOGIN_SERVICE_PROVIDER_ENTITY_ID
              value: https://docs.${DEPLOY_ENV}.ccs.guidewire.net/customers-login
          resources:
            requests:
              memory: "1Gi"
              cpu: "1"
            limits:
              memory: "1Gi"
              cpu: "1"
      imagePullSecrets:
        - name: artifactory-secret