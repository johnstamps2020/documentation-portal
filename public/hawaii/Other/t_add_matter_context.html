
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:whc="http://www.oxygenxml.com/webhelp/components" xml:lang="en-us" lang="en-us">
    <head><link rel="shortcut icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><link rel="icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta charset="UTF-8" /><meta name="copyright" content="(C) Copyright 2019" /><meta name="DC.rights.owner" content="(C) Copyright 2019" /><meta name="DC.type" content="task" /><meta name="description" content="It is possible to add a new context definition to a business rule. For example, you can add a matter context that triggers the creation of an activity upon update of a matter." /><meta name="DC.format" content="HTML5" /><meta name="DC.identifier" content="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b" /><meta name="DC.language" content="en-US" />        
      <title>Add new matter context to an activity rule</title><!--  Generated with Oxygen version 21.1, build number 2019083011.  --><meta name="wh-path2root" content="../" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/arial-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-regular.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-light-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-extralight-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-black-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-semibold-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/AvenirNextLTPro-Regular.woff" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/cour.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/js/simplebar.js" as="script" /><link rel="preload" href="../oxygen-webhelp/template/resources/css/simplebar.min.css" as="style" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/dharmachakra.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-right.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/share-alt.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/print-solid.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/times.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/angle-double-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/note.svg" as="image" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css?buildId=20191106" /><link rel="stylesheet" href="../oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css?buildId=20191106" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic-page.css?buildId=2019083011" /><script type="text/javascript" src="../oxygen-webhelp/lib/jquery/jquery-3.4.1.min.js?buildId=20191106"><!----></script><script data-main="../oxygen-webhelp/app/topic-page.js" src="../oxygen-webhelp/lib/requirejs/require.js"></script><link rel="preload" href="" as="document" /><link rel="preload" href="" as="document" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/resources/css/Guidewire-whr.css?buildId=2019083011" /></head>
    
    <body id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">Jump to main content</a>
        <!-- EXM-36950 - Expand the args.hdr parameter here -->
        
        
        
        <header class="navbar navbar-default wh_header navbar-fixed-top" id="affix1">
    <div class="container-fluid">
        <div class="wh_header_flex_container">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <!--
                            This component will be generated when the next parameters are specified in the transformation scenario:
                            'webhelp.logo.image' and 'webhelp.logo.image.target.url'.
                            See: http://oxygenxml.com/doc/versions/17.1/ug-editor/#topics/dita_webhelp_output.html.
                    -->
                    <a href="../index.html" class=" wh_logo not-hidden-xs "><img src="../oxygen-webhelp/template/resources/images/Guidewire_mini_logo.jpg" alt="Hawaii Documentation Demo" /></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="title">Hawaii Documentation Demo</span></a></div>
                    
                </div>
                
                <!-- The menu button for mobile devices is copied in the output only when the 'webhelp.show.top.menu' parameter is set to 'yes' -->
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
				
                
                
            </div>
			<!-- <div class="publicationDropDown">This Publication</div> -->
			<div class=" wh_search_input "><form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required" /><button type="submit" class="wh_search_button" aria-label="Search"><span>Search</span></button></div></form></div>
			<div id="userAccount">
			<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span>
            <!--<span id="accountInfo"></span>-->            
            <span class="dropdown" id="show_profile" style="display: none;">
                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                    <span class="fas fa-dharmachakra"></span></button>
                <ul class="dropdown-menu">
                    <li class="avatar_userName"></li>
                    <li class="divider" id="divider-admin"></li>
                    <li><a href="#" id="bt_editProfile">Edit</a></li>
                    <li><a href="#" id="bt_logOff">Logout</a></li>
                </ul>
            </span>
            
            </div>
			<!-- <div class="Login">
				<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span></div> -->
        </div>
    </div>
</header>
        
        <!--<whc:webhelp_search_input/>-->
        
        <div class="container-fluid">
            <div class="row navbar navbar-fixed-top" id="affix2">
                <nav class="wh_tools hidden-print">
                    <span class="openNav" type="button" aria-expanded="true"><i class="fas fa-bars"></i></span>
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "></div>
                    <div class="wh_right_tools hidden-sm hidden-xs">
                        <div class=" wh_navigation_links "><span id="topic_navigation_links_header" class="navheader"></span></div>
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <!--<whc:webhelp_expand_collapse_sections/>-->
                        <span class=" shareLink share "><a class="button fas fa-share-alt" data-sharer="email" data-title="" data-url="" data-subject="" data-to="" title="Share this page" aria-label="Share this page" href=""></a></span>
                        <!-- <whc:webhelp_pdf_link class="pdf"/> -->
                        <span class=" whPrintLink print "><button class="fas fa-print fa-1x" onClick="window.print()" title="Print this page" aria-label="Print this page"></button></span>
                    </div>
                </nav>
            </div>
            
            <div class="wh_content_area">
                <div class="row justify-content-lg-end">
                    
                    
                    <div id="wh_topic_body" class="col-lg-6 col-md-9 col-sm-9 col-xs-12"><!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="ariaid-title1">
  <h1 class="title topictitle1" id="ariaid-title1">Add new matter context to an activity rule</h1>
  
  <div class="body taskbody"><p class="shortdesc">It is possible to add a new context definition to
    a business rule. For example, you can add a matter context that triggers the creation of an
    activity upon update of a matter.</p>
    <section><div class="tasklabel"><h2 class="sectiontitle tasklabel">Procedure</h2></div><ol class="ol steps"><li class="li step stepexpand">
        <span class="ph cmd">Open ClaimCenter Studio.  </span>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Create a <code class="ph codeph">RuleContextDefinitionKey</code> typelist extension, if one does not
          exist.</span>
        <ol type="a" class="ol substeps">
          <li class="li substep">
            <span class="ph cmd">Add the following typecode to the typelist extension.</span>
            <div class="itemgroup info">
              <table class="table frame-all" id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b__table_mkn_jqx_xcc"><colgroup><col /><col /></colgroup><tbody class="tbody">
                    <tr>
                      <td class="entry"><span class="ph uicontrol">Code</span></td>
                      <td class="entry"><kbd class="ph userinput">Matter</kbd></td>
                    </tr>
                    <tr>
                      <td class="entry"><span class="ph uicontrol">Name</span></td>
                      <td class="entry"><kbd class="ph userinput">Matter</kbd></td>
                    </tr>
                  </tbody></table>
            </div>
          </li>
          <li class="li substep">
            <span class="ph cmd">Manually add a category to the new typecode by inserting the following code in text
              view.</span>
            <div class="itemgroup info"><ul class="sl simple">
                <li class="sli"><code class="ph codeph">&lt;category code="ActivityRule" typelist="Rule"/&gt;</code></li>
              </ul>
The Rule typelist is a generated typelist (from <span class="ph filepath">Rule.eti</span>). As
              such, you need to enter the category information manually, using the
                <span class="ph uicontrol">Text</span> tab for the typelist.</div>
          </li>
        </ol>
      </li><li class="li step stepexpand">
        <span class="ph cmd">In the Studio <span class="ph uicontrol">Project</span> window,
          navigate to <span class="ph uicontrol">gsrc</span> and create a
          package to hold your work.</span>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Add a new <code class="ph codeph">enum</code> class in your work package. Name it
            <span class="keyword apiname">CCRulesContextParameterNameExtension</span> and populate the class with code
          similar to the following.</span>
        <div class="itemgroup stepxmp">
          <pre class="pre codeblock"><code>package ...

enum CCRulesContextParameterNameExtension {
  matter
}</code></pre>
        </div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Enhance the <span class="keyword apiname">AbstractCommandParemeterSet</span> class (in the
            <span class="ph filepath">gw.bizrules.ruleaction.config</span> package) to create a new Matter
          variable. Name the new class <span class="keyword apiname">AbstractCommandParameterSetEnhancement</span>,
          place it in your working package, and populate the enhancement class with code similar to
          the following.</span>
        <div class="itemgroup stepxmp">
          <pre class="pre codeblock"><code>package ...

uses gw.bizrules.ruleaction.config.AbstractCommandParameterSet

enhancement AbstractCommandParameterSetEnhancement : AbstractCommandParameterSet {

  property get Matter() : Matter {
    return this._extensionParameters.get("MATTER") as Matter
  }

  property set Matter(matter : Matter) {
    this._extensionParameters.put("MATTER",matter)
  }
}</code></pre>
        </div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Enhance the <span class="keyword apiname">BaseCommandParameterConfig</span> class to create a new Matter
          command parameter. Name the enhancement
            <span class="keyword apiname">BaseCommandParameterConfigEnhancement</span> and populate the enhancement
          class with code similar to the following.</span>
        <div class="itemgroup stepxmp">
          <pre class="pre codeblock"><code>package ...

uses gw.bizrules.ruleaction.config.AbstractCommandParameterSet
uses gw.bizrules.ruleaction.config.BaseCommandParameterConfig
uses gw.bizrules.ruleaction.config.CCCommandParameterDefinition
uses gw.bizrules.ruleaction.config.CCCommandParameterUIConfigBuilder

enhancement BaseCommandParameterConfigEnhancement : BaseCommandParameterConfig {
  property get MATTER() : CCCommandParameterDefinition {   
    return new CCCommandParameterDefinition() { 
     :Name = "Matter",        
     :Property = AbstractCommandParameterSet#Matter,      
     :UIConfig = new CCCommandParameterUIConfigBuilder()
           .withContextParameterPassThrough(CCRulesContextParameterNameExtension.matter.Name)
           .build()
    }  
  }
}</code></pre>
        </div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Create a new <span class="keyword apiname">MatterTriggeringPoint</span> class to manage the new Matter
          context.</span>
        <div class="itemgroup stepxmp">Open one or two classes with names similar to the class that you want to create and
          review their contents. For example, review class <span class="keyword apiname">ClaimMatteringPoint</span>.
          Populate your new class with code similar to the
          following.<pre class="pre codeblock"><code>package ...

uses gw.bizrules.context.CCRulesContextParameterName
uses gw.bizrules.context.ClaimActivityRuleApplicabilityCriteriaPredicate
uses gw.bizrules.context.ClaimCCRuleApplicabilityCriteriaPredicate
uses gw.bizrules.context.RuleContextBuilder
uses gw.bizrules.IRuleContext
uses gw.bizrules.ITriggeringPoint
uses gw.plugin.bizrules.ICCBizRulesPlugin
uses gw.plugin.Plugins

uses java.util.function.Predicate

class MatterTriggeringPoint  implements ITriggeringPoint {

  private var  _key : TriggeringPointKey
  private var  _applicabilityCriteria : ClaimCCRuleApplicabilityCriteriaPredicate

  /**
    * Context Objects
    */
  private var  _claim : Claim
  private var  _matter : Matter

  construct(key : TriggeringPointKey, matter : Matter) {
    _key = key;
    _claim = matter.Claim;
    _matter = matter;
    _applicabilityCriteria = new ClaimActivityRuleApplicabilityCriteriaPredicate(_claim)
  }

  override property get Key(): TriggeringPointKey {
    return  _key
  }

  private static final var SUPPORTED_CONTEXTS = {
    RuleContextDefinitionKey.TC_MATTER
  }.toSet().freeze()

  override function supportedContexts(): Set&lt;RuleContextDefinitionKey&gt; {
    return SUPPORTED_CONTEXTS
  }

  override function generateContexts(contextDefinitionKey: RuleContextDefinitionKey): List&lt;IRuleContext&gt; {
    switch(contextDefinitionKey) {

      // Claim Context contains the symbol "matter"
      case 
        RuleContextDefinitionKey.TC_MATTER:
          return {new RuleContextBuilder()
                .forContextDefinitionKey(contextDefinitionKey)
                .withSymbol(CCRulesContextParameterName.claim.Name, _claim)
                .withSymbol(CCRulesContextParameterNameExtension.matter.Name, _matter)
                .withSymbol(CCRulesContextParameterName.Util.Name,Plugins.get(ICCBizRulesPlugin).BizRulesUtility)
                .build()}
        default: 
          throw new IllegalArgumentException("Unsupported context: " + contextDefinitionKey)
      }
  }

  override property get RuleApplicabilityPredicate(): Predicate&lt;RuleVersion&gt; {
    return _applicabilityCriteria
  }
}</code></pre></div>
        <div class="itemgroup info">
          <p class="p">In your implementation of a <span class="keyword apiname">TriggeringPoint</span> class, you control the
            number and type of symbols to add. With that said, Guidewire recommends (but does not
            require) that you always include a Claim symbol in your list of context symbols.
            Remember that whatever context symbols you add to your
              <span class="keyword apiname">TriggeringPoint</span> class you must also add to the list of context
            definitions in class <span class="keyword apiname">CCBizRulesPlugin</span>.</p>
        </div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Create a Gosu Matter Preupdate rule to trigger execution of the
            <span class="keyword apiname">MatterTriggeringPoint</span> class.</span>
        <div class="itemgroup stepxmp">As ClaimCenter triggers all business rules off of Gosu rules, you need to add a
          Gosu rule that references your <span class="keyword apiname">MatterTriggeringPoint</span> class. Updating a
          matter in ClaimCenter triggers the Matter Preupdate rule, which then passes the specific
          matter for update to class
          <span class="keyword apiname">MatterTriggeringPoint</span>.<pre class="pre codeblock"><code>USES:
uses gw.bizrules.<var class="keyword varname">package</var>.MatterTriggeringPoint

CONDITION: (matter : entity.Matter):
return true

ACTION (matter : entity.Matter, actions : gw.rules.Action):
  gw.bizrules.BizRulesExecutor.getInstance()
      .trigger(new <strong class="ph b">MatterTriggeringPoint</strong>(TriggeringPointKey.TC_UPDATE, <strong class="ph b">matter</strong>))

END</code></pre></div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Add entries for the matter-related display keys that you need to the display property
          file appropriate for your locale.</span>
        <div class="itemgroup stepxmp">
          <p class="p"><span class="ph">Navigate in the <span class="keyword wintitle">Project</span> window to <span class="ph menucascade"><span class="ph uicontrol">configuration</span><abbr title="and then"> &gt; </abbr><span class="ph uicontrol">config</span><abbr title="and then"> &gt; </abbr><span class="ph uicontrol">Localizations</span><abbr title="and then"> &gt; </abbr><span class="ph uicontrol">Resource Bundle 'display'</span></span> and double-click <span class="ph filepath">display.properties</span> to open
    this file in the editor.</span> Then add the following keys:</p>
          <pre class="pre codeblock"><code>Web.ActivityRules.Action.GenerateActivity.Assignee.MatterCreator = Matter Creator
Web.ActivityRules.Action.GenerateActivity.Assignee.MatterOwner = Matter Owner
Web.ActivityRules.Action.GenerateActivity.Restriction.Matter = No duplicate Activity on Matter
Web.ActivityRules.Action.RelatedTo.Matter = Matter</code></pre>
        </div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Create a new <span class="keyword apiname">MatterOwnerActivityAssigneeLoader</span> class.</span>
        <div class="itemgroup stepxmp">Open one or two classes with names similar to the class that you want to create and
          review their contents. For example, open class
            <span class="keyword apiname">ExposureOwnerActivityAssigneeLoader</span> and review its contents. Populate
          your new class with code similar to the
          following.<pre class="pre codeblock"><code>package ...

uses com.google.common.base.Preconditions
uses gw.api.locale.DisplayKey
uses gw.bizrules.ruleaction.behavioralcommandparam.assignee.ActivityAssignee
uses gw.bizrules.ruleaction.behavioralcommandparam.assignee.BaseActivityAssigneeLoader
uses gw.bizrules.ruleaction.behavioralcommandparam.assignee.UserBasedActivityAssignee
uses gw.bizrules.ruleaction.generateactivity.config.GenerateActivityCommandParameterSet

/**
  * Behavioral Command Parameter Value loads a UserBasedActivityAssignee to assign
  * the activity to the matter owner
  */
class MatterOwnerActivityAssigneeLoader extends BaseActivityAssigneeLoader {

  /**
    * Name of the Behavioral Command Parameter Value
    */
  public final static var NAME : String = "Matter_Owner"
  
  /**
   * Singleton Instance
   */
  public static var INSTANCE : MatterOwnerActivityAssigneeLoader = 
        new MatterOwnerActivityAssigneeLoader()

  public construct() {
    _name = NAME
    _uidisplay = DisplayKey.get("Web.ActivityRules.Action.GenerateActivity.Assignee.MatterOwner")  
    _directlyAssignable = true
    _additionalInfoMode = null
  }

  override public function loadActivityAssignee(params : GenerateActivityCommandParameterSet) : 
        List&lt;ActivityAssignee&gt; {
    Preconditions.checkArgument(params.Matter != null,  
          "Cannot create Matter Owner assignee for parameter set with null Matter")
    return {new UserBasedActivityAssignee(params.Matter.AssignedUser)}
  }
}</code></pre></div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Create a new <span class="keyword apiname">MatterCreatorActivityAssigneeLoader</span> class. </span>
        <div class="itemgroup stepxmp">Open one or two classes with names similar to the class that you want to create and
          review their contents. For example, open class
            <span class="keyword apiname">ExposureCreaterActivityAssigneeLoader</span> and review its contents.
          Populate your new class with code similar to the
          following.<pre class="pre codeblock"><code>package ...

uses com.google.common.base.Preconditions
uses gw.api.locale.DisplayKey
uses gw.bizrules.ruleaction.behavioralcommandparam.assignee.ActivityAssignee
uses gw.bizrules.ruleaction.behavioralcommandparam.assignee.BaseActivityAssigneeLoader
uses gw.bizrules.ruleaction.behavioralcommandparam.assignee.UserBasedActivityAssignee
uses gw.bizrules.ruleaction.generateactivity.config.GenerateActivityCommandParameterSet

/**
  * Behavioral Command Parameter Value loads a UserBasedActivityAssignee to assign
  * the activity to the matter creator
  */
class MatterCreatorActivityAssigneeLoader extends BaseActivityAssigneeLoader {

  /**
   * Name of the Behavioral Command Parameter Value
   */
  public final static var NAME : String = "Matter_Creator"

  /**
   * Singleton Instance
   */
  public static var INSTANCE : MatterCreatorActivityAssigneeLoader = 
        new MatterCreatorActivityAssigneeLoader()

  public construct() {
    _name = NAME
    _uidisplay = DisplayKey.get("Web.ActivityRules.Action.GenerateActivity.Assignee.MatterCreator")
    _directlyAssignable = true
    _additionalInfoMode = null
  }

  override public function loadActivityAssignee(params : GenerateActivityCommandParameterSet) : 
        List&lt;ActivityAssignee&gt; {
    Preconditions.checkArgument(params.Matter != null, 
          "Cannot create Matter Assignee for parameter set without Matter")
    return { new UserBasedActivityAssignee(params.Matter.getCreateUser()) }
  }
}</code></pre></div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Create a new <span class="keyword apiname">DuplicateMatterActivityRestriction</span> class similar to
            <span class="keyword apiname">DuplicateClaimActivityRestriction</span>.</span>
        <div class="itemgroup stepxmp">For example, create something similar to the following
          class.<pre class="pre codeblock"><code>package ...

uses gw.api.locale.DisplayKey
uses gw.bizrules.ruleaction.behavioralcommandparam.activityrestriction.BaseActivityRestriction
uses gw.bizrules.ruleaction.behavioralcommandparam.assignee.ActivityAssignee
uses gw.bizrules.ruleaction.generateactivity.config.GenerateActivityCommandParameterSet
uses entity.Activity

/**
  * Behavioral Command Parameter Value describes the ActivityRestriction where no duplicate activity
  * should be generated for matter
  */
class DuplicateMatterActivityRestriction extends BaseActivityRestriction {

  /**
    * Name of the Behavioral Command Parameter Value
    */
  public final static var NAME : String = "Duplicate_Activity_Matter"

  /**
    * Singleton Instance
    */
  public static var INSTANCE : DuplicateMatterActivityRestriction = 
        new DuplicateMatterActivityRestriction()

  construct() {
    _name = NAME
    _uidisplay = DisplayKey.get("Web.ActivityRules.Action.GenerateActivity.Restriction.Matter")
  }

  override public function checkIfActivityRestricted(acts : Activity[],
      params : GenerateActivityCommandParameterSet,
      assignee : ActivityAssignee) : boolean {
    return acts.hasMatch(\ act -&gt; act.ActivityPattern.Code == params.Pattern)
  }
}</code></pre></div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Add an entry for the new matter context to class
            <span class="keyword apiname">ActivityAssigneeDefaultValueHandler</span> (in package
            <span class="keyword apiname">gw.bizrules.ruleaction.defaultvaluehandler</span>).</span>
        <ol type="a" class="ol substeps" id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b__substeps_xx3_cwk_ycb">
          <li class="li substep">
            <span class="ph cmd">Find the <code class="ph codeph">if</code> statement in the class that starts with the following
              text:</span>
            <div class="itemgroup info">
              <pre class="pre codeblock"><code>if (ruleContextKey == RuleContextDefinitionKey.TC_EXPOSURE...</code></pre>
            </div>
          </li>
          <li class="li substep">
            <span class="ph cmd">Add a new <code class="ph codeph">else if</code> statement at the end of the <code class="ph codeph">if</code>
              statement for the new matter context definition that is similar to the existing
              context definitions.</span>
            <div class="itemgroup stepxmp">For example, add code similar to the following to the end of the
                <code class="ph codeph">if</code>
              statement:<pre class="pre codeblock"><code>else if (ruleContextKey == RuleContextDefinitionKey.TC_MATTER){
  assignees.add(MatterCreatorActivityAssigneeLoader.INSTANCE)
}</code></pre></div>
          </li>
        </ol>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Add an entry for the new matter context to class
            <span class="keyword apiname">ActivityRestrictionDefaultValueHandler</span> (in package
            <span class="keyword apiname">gw.bizrules.ruleaction.defaultvaluehandler</span>).</span>
        <ol type="a" class="ol substeps" id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b__substeps_sbt_pys_ycb">
          <li class="li substep">
            <span class="ph cmd">Find the <code class="ph codeph">if</code> statement in the class that starts with the following
              text:</span>
            <div class="itemgroup info">
              <pre class="pre codeblock"><code>if (ruleContextKey == RuleContextDefinitionKey.TC_EXPOSURE</code></pre>
            </div>
          </li>
          <li class="li substep">
            <span class="ph cmd">Add the following line to towards the end of the <code class="ph codeph">if</code> statement,
              directly above the <code class="ph codeph">null</code> statement.</span>
            <div class="itemgroup stepxmp">
              <pre class="pre codeblock"><code>|| ruleContextKey == RuleContextDefinitionKey.TC_MATTER</code></pre>
            </div>
          </li>
          <li class="li substep">
            <span class="ph cmd">In the same <code class="ph codeph">if</code> statement, search for the
                <code class="ph codeph">restrictsList</code> code and add the following restriction in an
              appropriate place.</span>
            <div class="itemgroup info">
              <pre class="pre codeblock"><code>restrictsList.add(DuplicateMatterActivityRestriction.INSTANCE)</code></pre>
            </div>
          </li>
        </ol>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Create a new <span class="keyword apiname">MatterRelatedTo</span> class that is similar to the
            <span class="keyword apiname">ClaimRelatedTo</span> class.</span>
        <div class="itemgroup stepxmp">For example, create something similar to the following
          class.<pre class="pre codeblock"><code>package ...

uses gw.api.locale.DisplayKey
uses gw.bizrules.ruleaction.behavioralcommandparam.relatedto.BaseActivityRulesRelatedTo
uses gw.bizrules.ruleaction.config.AbstractCommandParameterSet
uses gw.bizrules.ruleaction.generatehistoryevent.config.GenerateHistoryEventCommandParameterSet
uses gw.pl.persistence.core.Bean

/**
  * Behavioral Command Parameter Value describes the ActivityRulesRelatedTo where the activity
  * is related to Matter
  */
 class MatterRelatedTo extends BaseActivityRulesRelatedTo {

  /**
    * Name of the Behavioral Command Parameter Value
    */
  public final static var NAME : String = "Matter"

  /**
    * Singleton Instance
    */
  public static var INSTANCE : MatterRelatedTo = new MatterRelatedTo()

  construct() {
    _name = NAME
    _uidisplay = DisplayKey.get("Web.ActivityRules.Action.RelatedTo.Matter")
  }

  override function getRelatedToBean(paramSet: AbstractCommandParameterSet) : Bean {
    if(paramSet.Matter == null) {
      throw new IllegalStateException("Expected RelatedTo parameter for MatterRelatedTo was null.")
    }
  return paramSet.Matter
  }

  override function createHistory(paramSet : GenerateHistoryEventCommandParameterSet) : History {
    if(paramSet.Matter == null) {
      throw new IllegalStateException("Expected RelatedTo parameter for MatterRelatedTo was null.")
    }
    var history : History
    if (paramSet.Type != null) {
      if (paramSet.Type typeis HistoryType) {
        history = paramSet.Claim.createHistoryEvent(paramSet.Type, paramSet.Description)
      } else if (paramSet.Type typeis CustomHistoryType) {
        history = paramSet.Claim.createCustomHistoryEvent(paramSet.Type, paramSet.Description)
      }
    } else {
        throw new IllegalStateException("Neither Type or CustomType were set 
              on GenerateHistoryEventCommandParameterSet, unable to make history")
    }
    return history
  }
}</code></pre></div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Add an entry for the new matter context to class
            <span class="keyword apiname">RelatedToDefaultValueHandler</span> (in package
            <span class="keyword apiname">gw.bizrules.ruleaction.defaultvaluehandler</span>).</span>
        <ol type="a" class="ol substeps" id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b__substeps_jcw_khf_ycb">
          <li class="li substep">
            <span class="ph cmd">Find the last line of the code that defines the
                <code class="ph codeph">_defaultRelatedToMap</code> variable (before the closing curly brace) and
              add a comma at the end of that line.</span>
          </li>
          <li class="li substep">
            <span class="ph cmd">Add a <code class="ph codeph">RuleContextDefinitionKey</code> similar to the others for the new
              Matter context directly under that line.</span>
            <div class="itemgroup stepxmp">For
              example:<pre class="pre codeblock"><code>RuleContextDefinitionKey.TC_MATTER-&gt;MatterRelatedTo.INSTANCE</code></pre></div>
          </li>
          <li class="li substep">
            <span class="ph cmd">Add code similar to the following at the end of
                <code class="ph codeph">_relatedToSupportedContexts</code>:</span>
            <div class="itemgroup info">
              <pre class="pre codeblock"><code>RuleContextDefinitionKey.TC_MATTER-&gt;{    
  ClaimRelatedTo.INSTANCE,
  MatterRelatedTo.INSTANCE
}</code></pre>
            </div>
          </li>
        </ol>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Add a new method for the new matter context parameter to the
            <span class="keyword apiname">CCRuleCommandDefinitionBuilder</span> class.</span>
        <div class="itemgroup stepxmp">For example, add something similar to the following code to this
          class.<pre class="pre codeblock"><code>function withMatterContextParameter() : B { 
  addToMap(Config.MATTER, ExpressionFragmentBuilders.forCodeExpression("matter") )  
  return this as B
}</code></pre></div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Open class <span class="keyword apiname">CCBizRulesPlugin</span> (in package
            <span class="keyword apiname">gw.bizrules</span>) and add entries for the new matter context and the
          supporting classes that you created.</span>
        <ol type="a" class="ol substeps">
          <li class="li substep">
            <span class="ph cmd">Find the list of context definition variables and add the Matter context to the end
              of the list.</span>
            <div class="itemgroup stepxmp">For
              example:<pre class="pre codeblock"><code>var matterCD = new RuleContextDefinitionBuilder()
    .withRuleContextDefinitionKey(RuleContextDefinitionKey.TC_MATTER)
    .withSymbol(CCRulesContextParameterName.claim.Name, Claim)
    .withSymbol(CCRulesContextParameterName.Util.Name, ActivityRulesUtility)
    .withSymbol(CCRulesContextParameterNameExtension.matter.Name,Matter)
    .build()</code></pre></div>
          </li>
          <li class="li substep">
            <span class="ph cmd">Find the line that starts with
                <code class="ph codeph">_triggeringPoints.put(TriggeringPointKey.TC_UPDATE</code> and add
                <code class="ph codeph">matterCD</code> to the end of the list of contexts.</span>
            <div class="itemgroup stepxmp">For example, enter something similar to the following
              code.<pre class="pre codeblock"><code><strong class="ph b">_triggeringPoints.put(TriggeringPointKey.TC_UPDATE</strong>, {claimCD,exposureCD,expoIterCD,checksetIterCD,
      recoverysetIterCD,reservesetIterCD,recoveryreservesetIterCD,subroIterCD,<strong class="ph b">matterCD</strong>}
      .toTypedArray())</code></pre></div>
          </li>
          <li class="li substep">
            <span class="ph cmd">Search for the line that begins with <code class="ph codeph">override property get
                BehavioralCommandParameterExtensions()</code> and enter your class names as the
              comments indicate.</span>
            <div class="itemgroup stepxmp">For example, enter something similar to the following code additions in this
              class.<pre class="pre codeblock"><code>override property get BehavioralCommandParameterExtensions() : 
      Map&lt;Class, BehavioralCommandParameterExtension&gt; {
  return {
  
    ActivityAssigneeLoader-&gt;new BehavioralCommandParameterExtension&lt;ActivityAssigneeLoader&gt;() {  
      override function registerBehavioralCommandParameterValues(list: 
            List&lt;ActivityAssigneeLoader&gt;) {
         <strong class="ph b">// Add any new ActivityAssigneeLoaders to this list to be registered 
         // in class ActivityAssigneeLoaderFactory
        list.add(MatterCreatorActivityAssigneeLoader.INSTANCE)</strong>
      }
    },

    ActivityRulesRelatedTo-&gt;new BehavioralCommandParameterExtension&lt;ActivityRulesRelatedTo&gt;() {
      override function registerBehavioralCommandParameterValues(list: List&lt;ActivityRulesRelatedTo&gt;) {
         <strong class="ph b">// Add any new ActivityRulesRelatedTos to this list to be registered 
         // in class ActivityRulesRelatedToFactory
        list.add(MatterRelatedTo.INSTANCE)</strong>
      }
    },

    ActivityRestriction-&gt;new BehavioralCommandParameterExtension&lt;ActivityRestriction&gt;() {
      override function registerBehavioralCommandParameterValues(list: List&lt;ActivityRestriction&gt;) {
         <strong class="ph b">// Add any new ActivityRestrictions to this list to be registered 
         // in class ActivityRestrictionFactory
        list.add(DuplicateMatterActivityRestriction.INSTANCE)</strong>
      }
    }
  }
}</code></pre></div>
          </li>
        </ol>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Regenerate and recompile the Java class that backs the
            <code class="ph codeph">RuleContextDefinitionKey</code> typelist.</span>
        <ol type="a" class="ol substeps" id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b__substeps_n2f_vxd_1db">
          <li class="li substep">
            <span class="ph cmd">Save all your work.</span>
          </li>
          <li class="li substep">
            <span class="ph cmd">Select <span class="ph uicontrol">Generate Metadata
                Classes</span> from the Studio <span class="ph uicontrol">Codegen</span> menu.</span>
            <div class="itemgroup stepresult">This action regenerates class
                <span class="keyword apiname">RuleContextDefinitionKey.java</span>, adding the new matter typekey to
              the class.</div>
          </li>
          <li class="li substep">
            <span class="ph cmd">Select <span class="ph uicontrol">Make Project</span> from the
              Studio <span class="ph uicontrol">Build</span> menu.</span>
            <div class="itemgroup stepresult">This action recompiles the newly regenerated
                <span class="keyword apiname">RuleContextDefinitionKey</span> class. This action is necessary in order
              for the Gosu compiler to see the new typekey as it recompiles class
                <span class="keyword apiname">CCBizRulesPlugin</span> and other classes.</div>
          </li>
        </ol>
      </li><li class="li step stepexpand">
        <span class="ph cmd">If using an application server other than the default Quickstart server, create and
          deploy a WAR or EAR file as necessary.</span>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Open Guidewire ClaimCenter:</span>
        <ol type="a" class="ol substeps" id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b__substeps_spy_1bn_dfb">
          <li class="li substep">
            <span class="ph cmd">Create a new Activity business rule.</span>
          </li>
          <li class="li substep">
            <span class="ph cmd">Verify that you can see and chose the matter context under <span class="ph uicontrol">Trigger
                Entity</span>.</span>
          </li>
          <li class="li substep">
            <span class="ph cmd">In the <span class="ph uicontrol">Actions</span> area, select <span class="ph uicontrol">Generate
                Activity</span> and add an activity action to the rule.</span>
          </li>
        </ol>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Test that your activity rule executes as expected.</span>
        <ol type="a" class="ol substeps" id="xd_37cc0196d464f5df--3275f48e-161ad803679--7f5b__substeps_t3q_51n_dfb">
          <li class="li substep">
            <span class="ph cmd">Open a claim and add a new matter in the <span class="ph uicontrol">Litigation</span> screen,
              if one does not exist.</span>
          </li>
          <li class="li substep">
            <span class="ph cmd">Update the matter.</span>
          </li>
          <li class="li substep">
            <span class="ph cmd">In the claim <span class="ph uicontrol">Workplan</span> screen for that claim, verify that the
              matter update created a new activity as expected.</span>
          </li>
        </ol>
      </li></ol></section>   
  </div>
</article></main></div>
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" class="col-lg-2 hidden-sm hidden-xs navbar hidden-print"> <!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                            <div></div>
                        </nav>
                    
                </div>
            </div>
        </div> 
        <nav class="navbar navbar-default wh_footer navbar-bottom">
  <div class=" footer-container text-center ">
    <p><span class="footercopyright">© 2019 Guidewire Software, Inc.</span><span class="footerDate">Published November 20, 2019</span></p>
  </div>
</nav>
        
        <div id="go2top">
            <span class="glyphicon glyphicon-chevron-up"></span>
        </div>
        
        <!-- The modal container for images -->
        <div id="modal_img_large" class="modal">
            <span class="close glyphicon glyphicon-remove"></span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="modal-img" />
            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        
        <!-- <script src="${oxygen-webhelp-assets-dir}/lib/bootstrap/js/bootstrap.min.js" type="text/javascript"></script> -->
        
    </body>
</html>