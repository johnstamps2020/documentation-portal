
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:whc="http://www.oxygenxml.com/webhelp/components" xml:lang="en-us" lang="en-us">
    <head><link rel="shortcut icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><link rel="icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta charset="UTF-8" /><meta name="copyright" content="(C) Copyright 2019" /><meta name="DC.rights.owner" content="(C) Copyright 2019" /><meta name="DC.type" content="task" /><meta name="abstract" content="You must perform a sequence of manual steps if you want to revert to using the table statistics preferences set in database-config.xml rather than using Oracle AutoTask infrastructure to manage the task of collecting table statistics." /><meta name="description" content="You must perform a sequence of manual steps if you want to revert to using the table statistics preferences set in database-config.xml rather than using Oracle AutoTask infrastructure to manage the task of collecting table statistics." /><meta name="DC.format" content="HTML5" /><meta name="DC.identifier" content="xd_99c83c1c1ad989e6-2171d790-15e95a5a80d--7f08" /><meta name="DC.language" content="en-US" />        
      <title>Revert to DBStats batch processing for database statistics</title><!--  Generated with Oxygen version 21.1, build number 2019083011.  --><meta name="wh-path2root" content="../" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/arial-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-regular.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-light-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-extralight-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-black-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-semibold-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/AvenirNextLTPro-Regular.woff" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/cour.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/js/simplebar.js" as="script" /><link rel="preload" href="../oxygen-webhelp/template/resources/css/simplebar.min.css" as="style" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/dharmachakra.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-right.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/share-alt.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/print-solid.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/times.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/angle-double-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/note.svg" as="image" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css?buildId=20191106" /><link rel="stylesheet" href="../oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css?buildId=20191106" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic-page.css?buildId=2019083011" /><script type="text/javascript" src="../oxygen-webhelp/lib/jquery/jquery-3.4.1.min.js?buildId=20191106"><!----></script><script data-main="../oxygen-webhelp/app/topic-page.js" src="../oxygen-webhelp/lib/requirejs/require.js"></script><link rel="preload" href="" as="document" /><link rel="preload" href="" as="document" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/resources/css/Guidewire-whr.css?buildId=2019083011" /></head>
    
    <body id="xd_99c83c1c1ad989e6-2171d790-15e95a5a80d--7f08" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">Jump to main content</a>
        <!-- EXM-36950 - Expand the args.hdr parameter here -->
        
        
        
        <header class="navbar navbar-default wh_header navbar-fixed-top" id="affix1">
    <div class="container-fluid">
        <div class="wh_header_flex_container">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <!--
                            This component will be generated when the next parameters are specified in the transformation scenario:
                            'webhelp.logo.image' and 'webhelp.logo.image.target.url'.
                            See: http://oxygenxml.com/doc/versions/17.1/ug-editor/#topics/dita_webhelp_output.html.
                    -->
                    <a href="../index.html" class=" wh_logo not-hidden-xs "><img src="../oxygen-webhelp/template/resources/images/Guidewire_mini_logo.jpg" alt="Hawaii Documentation Demo" /></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="title">Hawaii Documentation Demo</span></a></div>
                    
                </div>
                
                <!-- The menu button for mobile devices is copied in the output only when the 'webhelp.show.top.menu' parameter is set to 'yes' -->
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
				
                
                
            </div>
			<!-- <div class="publicationDropDown">This Publication</div> -->
			<div class=" wh_search_input "><form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required" /><button type="submit" class="wh_search_button" aria-label="Search"><span>Search</span></button></div></form></div>
			<div id="userAccount">
			<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span>
            <!--<span id="accountInfo"></span>-->            
            <span class="dropdown" id="show_profile" style="display: none;">
                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                    <span class="fas fa-dharmachakra"></span></button>
                <ul class="dropdown-menu">
                    <li class="avatar_userName"></li>
                    <li class="divider" id="divider-admin"></li>
                    <li><a href="#" id="bt_editProfile">Edit</a></li>
                    <li><a href="#" id="bt_logOff">Logout</a></li>
                </ul>
            </span>
            
            </div>
			<!-- <div class="Login">
				<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span></div> -->
        </div>
    </div>
</header>
        
        <!--<whc:webhelp_search_input/>-->
        
        <div class="container-fluid">
            <div class="row navbar navbar-fixed-top" id="affix2">
                <nav class="wh_tools hidden-print">
                    <span class="openNav" type="button" aria-expanded="true"><i class="fas fa-bars"></i></span>
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "></div>
                    <div class="wh_right_tools hidden-sm hidden-xs">
                        <div class=" wh_navigation_links "><span id="topic_navigation_links_header" class="navheader"></span></div>
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <!--<whc:webhelp_expand_collapse_sections/>-->
                        <span class=" shareLink share "><a class="button fas fa-share-alt" data-sharer="email" data-title="" data-url="" data-subject="" data-to="" title="Share this page" aria-label="Share this page" href=""></a></span>
                        <!-- <whc:webhelp_pdf_link class="pdf"/> -->
                        <span class=" whPrintLink print "><button class="fas fa-print fa-1x" onClick="window.print()" title="Print this page" aria-label="Print this page"></button></span>
                    </div>
                </nav>
            </div>
            
            <div class="wh_content_area">
                <div class="row justify-content-lg-end">
                    
                    
                    <div id="wh_topic_body" class="col-lg-6 col-md-9 col-sm-9 col-xs-12"><!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="ariaid-title1">
  <h1 class="title topictitle1" id="ariaid-title1">Revert to DBStats batch processing for database statistics</h1>
  
  <div class="body taskbody"><div class="abstract"><span class="shortdesc">You must perform a sequence of manual steps if you want to revert to using
      the table statistics preferences set in <span class="ph filepath">database-config.xml</span> rather than
      using Oracle AutoTask infrastructure to manage the task of collecting table statistics.
    </span>Any change to the <code class="ph codeph">useoraclestatspreferences</code> attribute in
      <span class="ph filepath">database-config.xml</span> (from <code class="ph codeph">false</code> to <code class="ph codeph">true</code>
    or from <code class="ph codeph">true</code> to <code class="ph codeph">false</code>) takes effect only after an upgrade,
    which can be either a full database upgrade or a rolling configuration update. However, if you
    attempt to reset this attribute from <code class="ph codeph">true</code> to <code class="ph codeph">false</code>, <span class="keyword">GenericCenter</span> throws an exception during the next upgrade and prevents the
    upgrade from continuing due to locked statistics in certain Oracle database tables. Review the
    exception log detail to determine which tables statistics need to be unlocked.</div>
    <section><div class="tasklabel"><h2 class="sectiontitle tasklabel">Procedure</h2></div><ol class="ol steps"><li class="li step stepexpand">
        <span class="ph cmd">Reset attribute <code class="ph codeph">useoraclestatspreferences</code> to
            <code class="ph codeph">false</code> in file <code class="ph codeph">database-config</code>.</span>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Start the application server in upgrade mode.</span>
        <div class="itemgroup stepresult">The upgrade fails due to locked table statistics in the Oracle
          database.</div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Review the server log for which table statistics need to be unlocked.</span>
        <div class="itemgroup stepxmp">Search for text that is similar to the
          following:<pre class="pre msgblock">com.guidewire.pl.system.exception.UpgradeException: The following tables have locked statistics...</pre></div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Unlock the specified table statistics. </span>
        <div class="itemgroup stepxmp">The following example code illustrates what SQL commands the BillingCenter database
          DBA needs to execute.
          <pre class="pre codeblock"><code>SET serverout on timing on
DECLARE
CURSOR locked_tables_cur IS SELECT table_name
FROM user_tab_statistics
WHERE STATTYPE_LOCKED IS NOT NULL;
str VARCHAR2(256);
BEGIN
FOR locked_tables IN locked_tables_cur
LOOP
str:= 'EXEC DBMS_STATS.UNLOCK_TABLE_STATS(USER, ''' || locked_tables.table_name|| ''')' ;
dbms_output.put_line(str);
EXECUTE IMMEDIATE str;
END LOOP;
END;
/</code></pre></div>
        <div class="itemgroup info">This step is mandatory. Otherwise, the <span class="keyword">GenericCenter</span>
          upgrade fails. </div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Delete the current table statistics preferences. The following example code illustrates
          what SQL commands the BillingCenter database DBA needs to execute.</span>
        <div class="itemgroup stepxmp">
          <pre class="pre codeblock"><code>EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">BCUSER</var>', 'NO_INVALIDATE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">BCUSER</var>', 'CASCADE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">BCUSER</var>', 'STALE_PERCENT'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">BCUSER</var>', 'ESTIMATE_PERCENT'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">BCUSER</var>', 'DEGREE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">BCUSER</var>', 'METHOD_OPT');</code></pre>
          <pre class="pre codeblock"><code>EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">CCUSER</var>', 'NO_INVALIDATE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">CCUSER</var>', 'CASCADE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">CCUSER</var>', 'STALE_PERCENT'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">CCUSER</var>', 'ESTIMATE_PERCENT'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">CCUSER</var>', 'DEGREE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">CCUSER</var>', 'METHOD_OPT');</code></pre>
          <pre class="pre codeblock"><code>EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">PCUSER</var>', 'NO_INVALIDATE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">PCUSER</var>', 'CASCADE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">PCUSER</var>', 'STALE_PERCENT'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">PCUSER</var>', 'ESTIMATE_PERCENT'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">PCUSER</var>', 'DEGREE'); 
EXEC DBMS_STATS.DELETE_SCHEMA_PREFS('<var class="keyword varname">PCUSER</var>', 'METHOD_OPT');</code></pre>
        </div>
        <div class="itemgroup info">
          <div class="note note note_note"><span class="note__title">Note:</span> Replace <var class="keyword varname">BCUSER</var> with the actual <span class="keyword">GenericCenter</span> database user.</div>
          <div class="note note note_note"><span class="note__title">Note:</span> Replace <var class="keyword varname">CCUSER</var> with the actual <span class="keyword">GenericCenter</span> database user.</div>
          <div class="note note note_note"><span class="note__title">Note:</span> Replace <var class="keyword varname">PCUSER</var> with the actual <span class="keyword">GenericCenter</span> database user.</div>
        </div>
      </li><li class="li step stepexpand">
        <span class="ph cmd">Restart the application server in upgrade mode.</span>
      </li><li class="li step stepexpand">
        <span class="ph cmd">After the application upgrade completes, schedule the execution of
            <code class="ph codeph">DBStats</code> batch processing to collect database table statistics.</span>
      </li></ol></section>
  </div>
</article></main></div>
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" class="col-lg-2 hidden-sm hidden-xs navbar hidden-print"> <!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                            <div></div>
                        </nav>
                    
                </div>
            </div>
        </div> 
        <nav class="navbar navbar-default wh_footer navbar-bottom">
  <div class=" footer-container text-center ">
    <p><span class="footercopyright">© 2019 Guidewire Software, Inc.</span><span class="footerDate">Published November 20, 2019</span></p>
  </div>
</nav>
        
        <div id="go2top">
            <span class="glyphicon glyphicon-chevron-up"></span>
        </div>
        
        <!-- The modal container for images -->
        <div id="modal_img_large" class="modal">
            <span class="close glyphicon glyphicon-remove"></span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="modal-img" />
            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        
        <!-- <script src="${oxygen-webhelp-assets-dir}/lib/bootstrap/js/bootstrap.min.js" type="text/javascript"></script> -->
        
    </body>
</html>