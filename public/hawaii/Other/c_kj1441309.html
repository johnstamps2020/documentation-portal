
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:whc="http://www.oxygenxml.com/webhelp/components" xml:lang="en-us" lang="en-us">
    <head><link rel="shortcut icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><link rel="icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Important: &lt;&lt;JAHT 20161220 No date or author on this question&gt;&gt; Is this file for open source also??? clarify here for internal use Gosu provides APIs that protect shared data from access from multiple ..." /><meta charset="UTF-8" /><meta name="copyright" content="(C) Copyright 2019" /><meta name="DC.rights.owner" content="(C) Copyright 2019" /><meta name="DC.type" content="concept" /><meta name="DC.format" content="HTML5" /><meta name="DC.identifier" content="c_kj1441309" /><meta name="DC.language" content="en-US" /><title>Concurrency and thread safety</title><!--  Generated with Oxygen version 21.1, build number 2019083011.  --><meta name="wh-path2root" content="../" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/arial-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-regular.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-light-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-extralight-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-black-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-semibold-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/AvenirNextLTPro-Regular.woff" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/cour.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/js/simplebar.js" as="script" /><link rel="preload" href="../oxygen-webhelp/template/resources/css/simplebar.min.css" as="style" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/dharmachakra.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-right.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/share-alt.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/print-solid.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/times.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/angle-double-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/note.svg" as="image" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css?buildId=20191106" /><link rel="stylesheet" href="../oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css?buildId=20191106" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic-page.css?buildId=2019083011" /><script type="text/javascript" src="../oxygen-webhelp/lib/jquery/jquery-3.4.1.min.js?buildId=20191106"><!----></script><script data-main="../oxygen-webhelp/app/topic-page.js" src="../oxygen-webhelp/lib/requirejs/require.js"></script><link rel="preload" href="" as="document" /><link rel="preload" href="" as="document" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/resources/css/Guidewire-whr.css?buildId=2019083011" /></head>
    
    <body id="c_kj1441309" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">Jump to main content</a>
        <!-- EXM-36950 - Expand the args.hdr parameter here -->
        
        
        
        <header class="navbar navbar-default wh_header navbar-fixed-top" id="affix1">
    <div class="container-fluid">
        <div class="wh_header_flex_container">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <!--
                            This component will be generated when the next parameters are specified in the transformation scenario:
                            'webhelp.logo.image' and 'webhelp.logo.image.target.url'.
                            See: http://oxygenxml.com/doc/versions/17.1/ug-editor/#topics/dita_webhelp_output.html.
                    -->
                    <a href="../index.html" class=" wh_logo not-hidden-xs "><img src="../oxygen-webhelp/template/resources/images/Guidewire_mini_logo.jpg" alt="Hawaii Documentation Demo" /></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="title">Hawaii Documentation Demo</span></a></div>
                    
                </div>
                
                <!-- The menu button for mobile devices is copied in the output only when the 'webhelp.show.top.menu' parameter is set to 'yes' -->
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
				
                
                
            </div>
			<!-- <div class="publicationDropDown">This Publication</div> -->
			<div class=" wh_search_input "><form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required" /><button type="submit" class="wh_search_button" aria-label="Search"><span>Search</span></button></div></form></div>
			<div id="userAccount">
			<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span>
            <!--<span id="accountInfo"></span>-->            
            <span class="dropdown" id="show_profile" style="display: none;">
                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                    <span class="fas fa-dharmachakra"></span></button>
                <ul class="dropdown-menu">
                    <li class="avatar_userName"></li>
                    <li class="divider" id="divider-admin"></li>
                    <li><a href="#" id="bt_editProfile">Edit</a></li>
                    <li><a href="#" id="bt_logOff">Logout</a></li>
                </ul>
            </span>
            
            </div>
			<!-- <div class="Login">
				<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span></div> -->
        </div>
    </div>
</header>
        
        <!--<whc:webhelp_search_input/>-->
        
        <div class="container-fluid">
            <div class="row navbar navbar-fixed-top" id="affix2">
                <nav class="wh_tools hidden-print">
                    <span class="openNav" type="button" aria-expanded="true"><i class="fas fa-bars"></i></span>
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "></div>
                    <div class="wh_right_tools hidden-sm hidden-xs">
                        <div class=" wh_navigation_links "><span id="topic_navigation_links_header" class="navheader"></span></div>
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <!--<whc:webhelp_expand_collapse_sections/>-->
                        <span class=" shareLink share "><a class="button fas fa-share-alt" data-sharer="email" data-title="" data-url="" data-subject="" data-to="" title="Share this page" aria-label="Share this page" href=""></a></span>
                        <!-- <whc:webhelp_pdf_link class="pdf"/> -->
                        <span class=" whPrintLink print "><button class="fas fa-print fa-1x" onClick="window.print()" title="Print this page" aria-label="Print this page"></button></span>
                    </div>
                </nav>
            </div>
            
            <div class="wh_content_area">
                <div class="row justify-content-lg-end">
                    
                    
                    <div id="wh_topic_body" class="col-lg-6 col-md-9 col-sm-9 col-xs-12"><!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="c_kj1441309__kj1441309">

<h1 class="title topictitle1" id="c_kj1441309__kj1441309">Concurrency and thread safety</h1>
<div class="body conbody">
<div class="note important note_important"><span class="note__title">Important:</span> &lt;&lt;JAHT 20161220
No date or author on this question&gt;&gt; Is this file for open source
also??? clarify here for internal use</div>
<p class="p">Gosu provides APIs that protect shared data from access from multiple threads. </p>
    <p class="p" id="c_kj1441309__kj1448361">If more than one Gosu thread interacts with data structures that another
      thread needs, you must ensure that you protect data access to avoid data corruption. Because
      this topic involves concurrent access from multiple threads, this issue is called
        <dfn class="term">concurrency</dfn>. Code that is designed to safely get or set concurrently accessed
      data is called <dfn class="term">thread safe</dfn>.</p>
    <p class="p">The most common situation that requires concurrency handling is the use of data in class
      static variables. Static variables are variables that are stored once for a class rather than
      once for each instance of the class. If multiple threads on the same Java virtual machine
      access this class, you must ensure that simultaneous accesses to this data safely get or set
      the data.</p>
    <p class="p" id="c_kj1441309__kj1448812">If you are certain that static variables or other shared data are necessary,
      you must ensure that you synchronize access to static variables. <dfn class="term">Synchronization</dfn>
      refers to locking access between threads to shared resources such as static variables. For
      example, if you need to manage a single local memory cache that multiple threads use, you must
      carefully synchronize all reads and writes to shared data.</p>
    <div class="note warning note_warning"><span class="note__title">Warning:</span> Static variables can be extremely dangerous in a multi-threaded
      environment. Using static variables in a multi-threaded environment can cause problems in a
      production deployment if you do not properly synchronize access. If such problems occur, they
      are extremely difficult to diagnose and debug. Timing in an multi-user multi-threaded
      environment is difficult, if not impossible, to control in a testing environment.</div>
    <p class="p">In a Guidewire application, some contexts always require proper
      synchronization. For example, in a plugin implementation exactly one instance of that plugin
      exists in the Java virtual machine on each server. Your plugin code must have the following
      attributes:</p>
    <ul class="ul" id="c_kj1441309__ul_vhk_dfg_f3b">
      <li class="li">Your plugin must support multiple simultaneous calls to the same
        plugin method from different threads. You must ensure multiple calls to the plugin never
        access the same shared data. Alternatively, protect access to shared resources so that two
        threads never access it simultaneously. </li>
      <li class="li">Your code must support multiple simultaneous calls to a plugin
        instance. For example, <span class="keyword">GenericCenter</span> might call two different
        plugin methods at the same time. You must ensure multiple method calls to the plugin never
        access the same shared data. Alternatively, protect access to shared resources so that two
        threads never actually access it simultaneously.</li>
      <li class="li">Your plugin implementation must support multiple user sessions. Do
        not assume shared data or temporary storage is unique to one user request, which is one HTTP
        request from a single user.</li>
    </ul>

    <div class="p">Gosu provides the following types of concurrency APIs to support writing thread-safe code: <dl class="dl">
        
          <dt class="dt dlterm">Request and session variables</dt>
          <dd class="dd">The classes <code class="ph codeph">RequestVar</code> and <code class="ph codeph">SessionVar</code> in the package
              <code class="ph codeph">gw.api.web</code> synchronize and protect access to shared data. These APIs
            return a variable that is stored in either the request or the session.</dd>
        
        
          <dt class="dt dlterm">Lazy concurrent variables</dt>
          <dd class="dd">The <span class="keyword apiname">LockingLazyVar</span> class (in <code class="ph codeph">gw.util.concurrent</code>)
            implements what is known as a lazy variable. Gosu does not construct a <dfn class="term">lazy
              variable</dfn> until the first time any code uses the variable. Because the
              <span class="keyword apiname">LockingLazyVar</span> class uses the Java concurrency libraries, access to
            the lazy variable is thread-safe. The <span class="keyword apiname">LockingLazyVar</span> class wraps the
            double-checked locking pattern in a type-safe holder.</dd>
        
        
          <dt class="dt dlterm">Concurrent cache</dt>
          <dd class="dd">The <span class="keyword apiname">Cache</span> class in <code class="ph codeph">gw.util.concurrent</code> declares a
            cache of values that you can look up quickly and in a thread-safe way. It declares a
            concurrent cache similar to a Least Recently Used (LRU) cache. Because the
              <span class="keyword apiname">Cache</span> class uses the Java concurrency libraries, access to the
            concurrent cache is thread-safe. <div class="note warning note_warning"><span class="note__title">Warning:</span> Caches can cause subtle problems.
              Use caches only as a last resort for performance.</div></dd>
        
        
          <dt class="dt dlterm">Support for Java monitor locks, reentrant locks, and custom reentrant objects</dt>
          <dd class="dd">Gosu provides access to Java-based classes for monitor locks and reentrant locks in
            the Java package <code class="ph codeph">java.util.concurrent</code>. Gosu <code class="ph codeph">using</code>
            clauses provide access to these classes and properly handle cleanup if exceptions occur.
            Gosu also provides a readable syntax for creating custom objects for reentrant object
            handling.</dd>
        
      </dl></div>
    <section class="section"><h2 class="title sectiontitle">Concurrency API does not synchronize across clusters</h2>
      
      <p class="p">None of these concurrency APIs affect shared data across clusters. In practice, the only
        data shared across clusters is entity data. <span class="keyword">GenericCenter</span>
        includes built-in systems to synchronize and intelligently cache entity data across a
        cluster. </p>
    </section>
    <section class="section"><h2 class="title sectiontitle">Do not attempt to synchronize Guidewire entities</h2>
      
      <p class="p">Never try to synchronize access to Guidewire entities defined in the data model
        configuration files. <span class="keyword">GenericCenter</span> automatically manages
        synchronized access and entity loading and caching, both locally and across a cluster if you
        use clusters. </p>
      <p class="p" id="c_kj1441309__kj1556945">A transaction bundle based on the class
          <span class="keyword apiname">gw.transaction.Bundle</span> is not thread-safe. Be aware of any concurrency
        issues when accessing entity instances in a bundle or committing those instances to the
        database. If multiple users can access the entity instances in a bundle simultaneously, you
        must use external synchronization to ensure reading and writing correct data, such as for
        property values.</p>
      <div class="note warning note_warning"><span class="note__title">Warning:</span> Use external synchronization to ensure data
        integrity for concurrent access to entity instances in a transaction bundle.</div>
    </section>
    <section class="section">
      <p class="p seealso">See also</p>
      <ul class="ul" id="c_kj1441309__ul_fkk_dfg_f3b">
        <li seealso-li="yes" class="li"><a class="xref" href="c_kj1443367.html#c_kj1443367">Request and session scoped variables</a></li>
        <li seealso-li="yes" class="li"><a class="xref" href="c_kj1508633.html#c_kj1508633">Concurrent lazy variables</a></li>
        <li seealso-li="yes" class="li"><a class="xref" href="c_kj1507285.html#c_kj1507285">Concurrent cache</a></li>
        <li seealso-li="yes" class="li"><a class="xref" href="c_kj1453486.html#c_kj1453486">Concurrency with monitor locks and reentrant objects</a></li>
        <li seealso-li="yes" class="li"><a class="xref" href="c_ku1456387.html#c_ku1456387">Bundles and database transactions</a></li>
        <li seealso-li="yes" class="li html-only"><a class="xref" href="c_jt3812421.html#c_jt3812421">Web service class life cycle and variables scoped locally to a request</a></li>
        
      </ul>

    </section>
</div>
</article></main></div>
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" class="col-lg-2 hidden-sm hidden-xs navbar hidden-print"> <!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                            <div></div>
                        </nav>
                    
                </div>
            </div>
        </div> 
        <nav class="navbar navbar-default wh_footer navbar-bottom">
  <div class=" footer-container text-center ">
    <p><span class="footercopyright">© 2019 Guidewire Software, Inc.</span><span class="footerDate">Published November 20, 2019</span></p>
  </div>
</nav>
        
        <div id="go2top">
            <span class="glyphicon glyphicon-chevron-up"></span>
        </div>
        
        <!-- The modal container for images -->
        <div id="modal_img_large" class="modal">
            <span class="close glyphicon glyphicon-remove"></span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="modal-img" />
            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        
        <!-- <script src="${oxygen-webhelp-assets-dir}/lib/bootstrap/js/bootstrap.min.js" type="text/javascript"></script> -->
        
    </body>
</html>