
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:whc="http://www.oxygenxml.com/webhelp/components" xml:lang="en-us" lang="en-us">
    <head><link rel="shortcut icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><link rel="icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="From Gosu, you can use the Java 1.5 concurrency classes in the package java.util.concurrent to synchronize a variable’s data to prevent simultaneous access to the data. The most straightforward ..." /><meta charset="UTF-8" /><meta name="copyright" content="(C) Copyright 2019" /><meta name="DC.rights.owner" content="(C) Copyright 2019" /><meta name="DC.type" content="concept" /><meta name="DC.format" content="HTML5" /><meta name="DC.identifier" content="c_kj1453486" /><meta name="DC.language" content="en-US" /><title>Concurrency with monitor locks and reentrant objects</title><!--  Generated with Oxygen version 21.1, build number 2019083011.  --><meta name="wh-path2root" content="../" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/arial-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-regular.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-light-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-extralight-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-black-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-semibold-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/AvenirNextLTPro-Regular.woff" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/cour.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/js/simplebar.js" as="script" /><link rel="preload" href="../oxygen-webhelp/template/resources/css/simplebar.min.css" as="style" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/dharmachakra.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-right.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/share-alt.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/print-solid.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/times.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/angle-double-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/note.svg" as="image" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css?buildId=20191106" /><link rel="stylesheet" href="../oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css?buildId=20191106" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic-page.css?buildId=2019083011" /><script type="text/javascript" src="../oxygen-webhelp/lib/jquery/jquery-3.4.1.min.js?buildId=20191106"><!----></script><script data-main="../oxygen-webhelp/app/topic-page.js" src="../oxygen-webhelp/lib/requirejs/require.js"></script><link rel="preload" href="" as="document" /><link rel="preload" href="" as="document" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/resources/css/Guidewire-whr.css?buildId=2019083011" /></head>
    
    <body id="c_kj1453486" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">Jump to main content</a>
        <!-- EXM-36950 - Expand the args.hdr parameter here -->
        
        
        
        <header class="navbar navbar-default wh_header navbar-fixed-top" id="affix1">
    <div class="container-fluid">
        <div class="wh_header_flex_container">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <!--
                            This component will be generated when the next parameters are specified in the transformation scenario:
                            'webhelp.logo.image' and 'webhelp.logo.image.target.url'.
                            See: http://oxygenxml.com/doc/versions/17.1/ug-editor/#topics/dita_webhelp_output.html.
                    -->
                    <a href="../index.html" class=" wh_logo not-hidden-xs "><img src="../oxygen-webhelp/template/resources/images/Guidewire_mini_logo.jpg" alt="Hawaii Documentation Demo" /></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="title">Hawaii Documentation Demo</span></a></div>
                    
                </div>
                
                <!-- The menu button for mobile devices is copied in the output only when the 'webhelp.show.top.menu' parameter is set to 'yes' -->
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
				
                
                
            </div>
			<!-- <div class="publicationDropDown">This Publication</div> -->
			<div class=" wh_search_input "><form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required" /><button type="submit" class="wh_search_button" aria-label="Search"><span>Search</span></button></div></form></div>
			<div id="userAccount">
			<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span>
            <!--<span id="accountInfo"></span>-->            
            <span class="dropdown" id="show_profile" style="display: none;">
                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                    <span class="fas fa-dharmachakra"></span></button>
                <ul class="dropdown-menu">
                    <li class="avatar_userName"></li>
                    <li class="divider" id="divider-admin"></li>
                    <li><a href="#" id="bt_editProfile">Edit</a></li>
                    <li><a href="#" id="bt_logOff">Logout</a></li>
                </ul>
            </span>
            
            </div>
			<!-- <div class="Login">
				<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span></div> -->
        </div>
    </div>
</header>
        
        <!--<whc:webhelp_search_input/>-->
        
        <div class="container-fluid">
            <div class="row navbar navbar-fixed-top" id="affix2">
                <nav class="wh_tools hidden-print">
                    <span class="openNav" type="button" aria-expanded="true"><i class="fas fa-bars"></i></span>
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "></div>
                    <div class="wh_right_tools hidden-sm hidden-xs">
                        <div class=" wh_navigation_links "><span id="topic_navigation_links_header" class="navheader"></span></div>
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <!--<whc:webhelp_expand_collapse_sections/>-->
                        <span class=" shareLink share "><a class="button fas fa-share-alt" data-sharer="email" data-title="" data-url="" data-subject="" data-to="" title="Share this page" aria-label="Share this page" href=""></a></span>
                        <!-- <whc:webhelp_pdf_link class="pdf"/> -->
                        <span class=" whPrintLink print "><button class="fas fa-print fa-1x" onClick="window.print()" title="Print this page" aria-label="Print this page"></button></span>
                    </div>
                </nav>
            </div>
            
            <div class="wh_content_area">
                <div class="row justify-content-lg-end">
                    
                    
                    <div id="wh_topic_body" class="col-lg-6 col-md-9 col-sm-9 col-xs-12"><!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="c_kj1453486__kj1453486">

<h1 class="title topictitle1" id="c_kj1453486__kj1453486">Concurrency with monitor locks and reentrant objects</h1>
<div class="body conbody">
<p class="p">From Gosu, you can use the Java 1.5 concurrency
classes in the package <code class="ph codeph">java.util.concurrent</code>
to synchronize a variable’s data to prevent simultaneous access to
the data.</p>
<p class="p">The most straightforward implementation
of a lock is to define a static variable for the lock in your class definition.
Next, define a property get accessor function that uses the lock and
calls another method to perform the task that you must synchronize. This
approach uses a Gosu <code class="ph codeph">using</code>
clause with reentrant objects to simplify concurrent access to shared
data. The <code class="ph codeph">using</code> statement
syntax for lock objects causes Gosu to consider the object reentrant.</p>

        <section class="section">
      <p class="p" id="c_kj1453486__d571e18">A <dfn class="term">reentrant</dfn> object supports multiple concurrent uses of a
        single lock in a single thread. Reentrancy maintains a count of the number of times the
        thread sets and releases the lock. In reentrant lock use, the thread does not deadlock on
        setting an already locked lock, nor release the lock when other code in the thread still
        retains that lock. Reentrant objects help manage safe access to data that is shared by
        reentrant or concurrent code execution. For example, if you must store data that is shared
        by multiple threads, ensure that you protect against concurrent access from multiple threads
        to prevent data corruption. The most prominent type of shared data is class static
        variables, which are variables that are stored on the Gosu class itself.</p>
      <p class="p">For Gosu to recognize a valid reentrant object, the object must have at least one of the
        following attributes:</p>
      <ul class="ul" id="c_kj1453486__d571e27">
        <li class="li">The object implements the
            <code class="ph codeph">java.util.concurrent.locks.Lock</code> interface. For example, the following
          Java classes in that package implement this interface: <code class="ph codeph">ReentrantLock</code>,
            <code class="ph codeph">ReadWriteLock</code>, <code class="ph codeph">Condition</code>.</li>
        <li class="li">You cast the object to the Gosu interface
            <code class="ph codeph">IMonitorLock</code>. You can cast any arbitrary object to
            <code class="ph codeph">IMonitorLock</code>. It is useful to cast Java monitor locks to this Gosu
          interface. </li>
        <li class="li">The object implements the Gosu class
            <span class="keyword apiname">gw.lang.IReentrant</span>. This interface contains two methods with no
          arguments: <code class="ph codeph">enter</code> and <code class="ph codeph">exit</code>. Your implementation code must
          properly lock or synchronize data access as appropriate during the
            <span class="keyword apiname">enter</span> method and release any locks in the <span class="keyword apiname">exit</span>
          method.</li>
      </ul>

      <p class="p">For blocks of code that use locks by implementing
          <code class="ph codeph">java.util.concurrent.locks.Lock</code>, a <code class="ph codeph">using</code> clause
        simplifies the code. The <code class="ph codeph">using</code> statement always cleans up the lock, even if
        the code throws an exception.</p>
      <pre class="pre codeblock"><code>uses java.util.concurrent

// In your class variable definitions...
var _lock : ReentrantLock = new ReentrantLock()

...

function useReentrantLockNew() {
  using ( _lock ) { 
    // Do your main work here
  }
}</code></pre>
      <p class="p">Similarly, you can cast any object to a monitor lock by adding
          <code class="ph codeph">as IMonitorLock</code> after the object. For example, the following method code
        uses the object itself, by using the keyword <code class="ph codeph">this</code>, as the monitor lock:</p>
      <pre class="pre codeblock"><code>function monitorLock() {
  using ( this as IMonitorLock ) {
    // Do stuff
  }
}</code></pre>
      <p class="p" id="c_kj1453486__d571e100">This approach is equivalent to a <code class="ph codeph">synchronized</code> block in the
        Java language.</p>
      <p class="p">The following code uses the <span class="keyword apiname">java.util.concurrent.locks.ReentrantLock</span>
        class using more verbose <code class="ph codeph">try</code> and <code class="ph codeph">finally</code> statements. This
        approach is not recommended:</p>
      <pre class="pre codeblock"><code>// In your class variable definitions...
var _lock : ReentrantLock = new ReentrantLock()

function useReentrantLockOld() {
  _lock.lock()
  try { 
    // Do your main work here
  }
  finally {
    lock.unlock()
  }
}</code></pre>
      <p class="p">Alternatively, you can do your change in a Gosu block. This approach is not recommended.
        Returning the value from a block imposes more restrictions on how you implement
          <code class="ph codeph">return</code> statements. It is typically better to use the
          <code class="ph codeph">using</code> statement structure shown earlier in this topic.</p>
      <pre class="pre codeblock"><code>uses java.util.concurrent

...

property get SomeProp() : Object {
  var retValue : Object
  _lock.with( \-&gt; {
    retValue = _someVar.someMethod()
  })
  return retValue
}</code></pre>
    </section>
        <section class="section">
            
            <p class="p seealso">See also</p>
            <ul class="ul" id="c_kj1453486__ul_dmv_1dn_b1b">
                <li seealso-li="yes" class="li"><a class="xref" href="c_kx1457329.html#c_kx1457329">Object life-cycle management with using clauses</a></li>
        <li seealso-li="yes" class="li"><a class="xref" href="http://en.wikipedia.org/wiki/Monitor_(synchronization)" target="_blank">http://en.wikipedia.org/wiki/Monitor_(synchronization)</a></li>
        <li seealso-li="yes" class="li"><a class="xref" href="http://docs.oracle.com/javase/tutorial/essential/concurrency/index.html" target="_blank">http://docs.oracle.com/javase/tutorial/essential/concurrency/index.html</a></li>
            </ul>

        </section>
</div>
</article></main></div>
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" class="col-lg-2 hidden-sm hidden-xs navbar hidden-print"> <!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                            <div></div>
                        </nav>
                    
                </div>
            </div>
        </div> 
        <nav class="navbar navbar-default wh_footer navbar-bottom">
  <div class=" footer-container text-center ">
    <p><span class="footercopyright">© 2019 Guidewire Software, Inc.</span><span class="footerDate">Published November 20, 2019</span></p>
  </div>
</nav>
        
        <div id="go2top">
            <span class="glyphicon glyphicon-chevron-up"></span>
        </div>
        
        <!-- The modal container for images -->
        <div id="modal_img_large" class="modal">
            <span class="close glyphicon glyphicon-remove"></span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="modal-img" />
            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        
        <!-- <script src="${oxygen-webhelp-assets-dir}/lib/bootstrap/js/bootstrap.min.js" type="text/javascript"></script> -->
        
    </body>
</html>