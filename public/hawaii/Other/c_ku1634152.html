
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:whc="http://www.oxygenxml.com/webhelp/components" xml:lang="en-us" lang="en-us">
    <head><link rel="shortcut icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><link rel="icon" href="../oxygen-webhelp/template/resources/images/webpagelogo.ico"><!----></link><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Typical Gosu code interacts with database transactions by using the current bundle set up for rules execution, plugin code, or PCF user interface code. In such cases, GenericCenter automatically ..." /><meta charset="UTF-8" /><meta name="copyright" content="(C) Copyright 2019" /><meta name="DC.rights.owner" content="(C) Copyright 2019" /><meta name="DC.type" content="concept" /><meta name="DC.format" content="HTML5" /><meta name="DC.identifier" content="c_ku1634152" /><meta name="DC.language" content="en-US" /><title>Running code in an entirely new bundle</title><!--  Generated with Oxygen version 21.1, build number 2019083011.  --><meta name="wh-path2root" content="../" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/arial-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-regular.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-light-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-extralight-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-black-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/sourcesanspro-semibold-webfont.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/AvenirNextLTPro-Regular.woff" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/fonts/cour.woff2" as="font" /><link rel="preload" href="../oxygen-webhelp/template/resources/js/simplebar.js" as="script" /><link rel="preload" href="../oxygen-webhelp/template/resources/css/simplebar.min.css" as="style" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/dharmachakra.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/chevron-right.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/share-alt.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/print-solid.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/times.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/angle-double-left.svg" as="image" /><link rel="preload" href="../oxygen-webhelp/template/resources/images/note.svg" as="image" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css?buildId=20191106" /><link rel="stylesheet" href="../oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css?buildId=20191106" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic-page.css?buildId=2019083011" /><script type="text/javascript" src="../oxygen-webhelp/lib/jquery/jquery-3.4.1.min.js?buildId=20191106"><!----></script><script data-main="../oxygen-webhelp/app/topic-page.js" src="../oxygen-webhelp/lib/requirejs/require.js"></script><link rel="preload" href="" as="document" /><link rel="preload" href="" as="document" /><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/resources/css/Guidewire-whr.css?buildId=2019083011" /></head>
    
    <body id="c_ku1634152" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">Jump to main content</a>
        <!-- EXM-36950 - Expand the args.hdr parameter here -->
        
        
        
        <header class="navbar navbar-default wh_header navbar-fixed-top" id="affix1">
    <div class="container-fluid">
        <div class="wh_header_flex_container">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <!--
                            This component will be generated when the next parameters are specified in the transformation scenario:
                            'webhelp.logo.image' and 'webhelp.logo.image.target.url'.
                            See: http://oxygenxml.com/doc/versions/17.1/ug-editor/#topics/dita_webhelp_output.html.
                    -->
                    <a href="../index.html" class=" wh_logo not-hidden-xs "><img src="../oxygen-webhelp/template/resources/images/Guidewire_mini_logo.jpg" alt="Hawaii Documentation Demo" /></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="title">Hawaii Documentation Demo</span></a></div>
                    
                </div>
                
                <!-- The menu button for mobile devices is copied in the output only when the 'webhelp.show.top.menu' parameter is set to 'yes' -->
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
				
                
                
            </div>
			<!-- <div class="publicationDropDown">This Publication</div> -->
			<div class=" wh_search_input "><form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required" /><button type="submit" class="wh_search_button" aria-label="Search"><span>Search</span></button></div></form></div>
			<div id="userAccount">
			<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span>
            <!--<span id="accountInfo"></span>-->            
            <span class="dropdown" id="show_profile" style="display: none;">
                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                    <span class="fas fa-dharmachakra"></span></button>
                <ul class="dropdown-menu">
                    <li class="avatar_userName"></li>
                    <li class="divider" id="divider-admin"></li>
                    <li><a href="#" id="bt_editProfile">Edit</a></li>
                    <li><a href="#" id="bt_logOff">Logout</a></li>
                </ul>
            </span>
            
            </div>
			<!-- <div class="Login">
				<span>
				<i class="fas fa-dharmachakra" id="bt_logIn"></i>
			</span></div> -->
        </div>
    </div>
</header>
        
        <!--<whc:webhelp_search_input/>-->
        
        <div class="container-fluid">
            <div class="row navbar navbar-fixed-top" id="affix2">
                <nav class="wh_tools hidden-print">
                    <span class="openNav" type="button" aria-expanded="true"><i class="fas fa-bars"></i></span>
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "></div>
                    <div class="wh_right_tools hidden-sm hidden-xs">
                        <div class=" wh_navigation_links "><span id="topic_navigation_links_header" class="navheader"></span></div>
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <!--<whc:webhelp_expand_collapse_sections/>-->
                        <span class=" shareLink share "><a class="button fas fa-share-alt" data-sharer="email" data-title="" data-url="" data-subject="" data-to="" title="Share this page" aria-label="Share this page" href=""></a></span>
                        <!-- <whc:webhelp_pdf_link class="pdf"/> -->
                        <span class=" whPrintLink print "><button class="fas fa-print fa-1x" onClick="window.print()" title="Print this page" aria-label="Print this page"></button></span>
                    </div>
                </nav>
            </div>
            
            <div class="wh_content_area">
                <div class="row justify-content-lg-end">
                    
                    
                    <div id="wh_topic_body" class="col-lg-6 col-md-9 col-sm-9 col-xs-12"><!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="c_ku1634152__ku1634152">

<h1 class="title topictitle1" id="c_ku1634152__ku1634152">Running code in an entirely new bundle</h1>
<div class="body conbody">
<p class="p">Typical Gosu code interacts with database transactions
by using the current bundle set up for rules execution, plugin code,
or PCF user interface code. In such cases, <span class="keyword">GenericCenter</span> automatically manage
the low level parts of database transactions. Only in rare cases your
code must create or commit a bundle explicitly, such as batch processes,
WS-I web service implementation classes, and actions triggered from workflows.</p>
<p class="p">In rare cases, you need to run Gosu code
in an entirely new transaction, so you create a new bundle. You might
need a new transaction because there is no current bundle or because
you need changes in a different transaction from the current transaction.</p>
<p class="p">Create your own bundle only in the following
cases:</p>
<ul class="ul">
<li class="li">If your code modifies entities
to commit independent of the success of the surrounding code. For example,
some workflow asynchronous actions or unusual PCF user interface code
might need to create a new bundle.</li>
<li class="li">If your code represents
a separate asynchronous actions from surrounding code.</li>
<li class="li">If your Gosu calls Java
code that spawns a new thread within the server, such as a timer or scheduled
event. It is important that no two threads share a bundle.</li>
</ul>

<p class="p">To run code within a separate transaction, you must
create a Gosu block, which is an in-line function that you define in-line
within another function. You can pass a block to other functions to invoke
as appropriate. </p>
<p class="p" id="c_ku1634152__ku1558859">To create a new bundle,
call the static method <span class="keyword apiname">runWithNewBundle</span> on the <span class="keyword apiname">gw.transaction.Transaction</span> class.
As a method argument, pass a Gosu block that takes one argument, which
is a bundle (<code class="ph codeph">Bundle</code>).
Gosu creates an entirely new bundle just for your code within the block. </p>
<p class="p">The syntax is:</p>
<pre class="pre codeblock"><code>uses gw.transaction.Transaction

...

Transaction.runWithNewBundle( \ bundle -&gt; <var class="keyword varname">YOUR_BLOCK_CODE_HERE</var> )</code></pre>
<p class="p">Your Gosu code within the block can add entity instances
to the bundle by using the <span class="keyword apiname">bundle.add(</span><var class="keyword varname">entity</var><span class="keyword apiname">)</span> method. Remember to save the
return result of the <span class="keyword apiname">add</span>
method. </p>
<p class="p">Gosu immediately runs this code synchronously.
If the block succeeds with no exceptions, <code class="ph codeph">runWithNewBundle</code> commits the new
bundle after your code completes. For the most concise and readable code,
Guidewire encourages you to use this automatic commit behavior rather
than committing the bundle explicitly. </p>
<p class="p">If your code detects error conditions,
throw an exception from the Gosu block. Gosu discards the bundle and
does not commit the changes.</p>
<p class="p">The following example demonstrates how
to create a new bundle to run code that creates a new entity instance
and modifies some fields. The current transaction is an argument to the
block. </p>
<p class="p">If you are adding entity instances, in
typical code you do not need to use the bundle explicitly. Gosu sets
the current bundle inside the block to this new block automatically.
You can use the no-argument version of the <code class="ph codeph">new</code> operator for entity types,
which creates the object in the current bundle:</p>
<pre class="pre codeblock"><code>gw.transaction.Transaction.runWithNewBundle( \b -&gt; {
  var me = new MyEntity()

  me.FirstName = firstName
  me.LastName = lastName
  me.PrimaryAddress = address
  me.EmailAddress1 = email
  me.WorkPhone = workPhone
  me.PrimaryPhone = primaryPhoneType
  me.TaxID = taxId
  me.FaxPhone = faxPhone
} )</code></pre>
<p class="p">If you perform database queries, you can use the bundle
reference to add entity instances to the new writable bundle. </p>
<div class="note warning note_warning"><span class="note__title">Warning:</span> Only commit a bundle
if you are sure that it is appropriate for that programming context.
Otherwise, you could causes data integrity problems. For example, in
Rule sets or PCF code, it is typically dangerous to commit a bundle explicitly,
including with this API. Contact Customer Support if you have questions.</div>
<section class="section"><h2 class="title sectiontitle">Using variable capturing in your block</h2><p class="p">The following example method from a web
service implementation demonstrates how to create a new bundle to call
a utility function that does the core part of the work. </p>
<pre class="pre codeblock"><code>...

public function myAction(customerID : String) : void {
  Transaction.runWithNewBundle( \ bundle -&gt; MyClass.doSomething(customerID, bundle))
}

...</code></pre>
<p class="p" id="c_ku1634152__ku1722425">This apparently simple block is not
self-contained because the code uses <code class="ph codeph">customerID</code>,
which is the argument to the <span class="keyword apiname">myAction</span>
method and is declared outside the scope of the block. The ability of
a block to use variables from its creation context is called <dfn class="term">variable capturing</dfn>. </p>
<p class="p">In some cases, you need to return information
from your block. You can return information by more advanced use of variable
capturing. The following example demonstrates variable capturing by creating
a local variable in the outer scope (<code class="ph codeph">myAction</code>)
and then setting its value from within the block. The outer scope can
use that value as a return value from the method.</p>
<pre class="pre codeblock"><code>public function myAction(customerID : String) : boolean {
  var res : boolean

  // The local variable "res" and the parameter "customerID" are captured by the block. 
  // Both variables are shared between the calling function and the block
  Transaction.runWithNewBundle( \ bundle -&gt; { res = MyClass.doSomething(customerID, bundle) })

  // Return the value that was set in the block using the shared (captured) variable
  return res 
}</code></pre>
<p class="p seealso">See also</p>
<ul class="ul">
<li seealso-li="yes" class="li"><a class="xref" href="c_fs1497199.html#c_fs1497199">Blocks</a></li>
<li seealso-li="yes" class="li"><a class="xref" href="c_fs1504743.html#c_fs1504743">Variable scope and capturing variables in blocks</a></li>
<li seealso-li="yes" class="li"><a class="xref" href="c_ku1611659.html#c_ku1611659">Adding entity instances to bundles</a></li>
<li seealso-li="yes" class="li"><a class="xref" href="c_ku1613756.html#c_ku1613756">Getting changes to entity arrays in the current bundle</a></li>
</ul>
</section>







</div>
</article></main></div>
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" class="col-lg-2 hidden-sm hidden-xs navbar hidden-print"> <!-- /*DOCS-323 WebHelp Feedback - Adjust column widths*/-->
                            <div></div>
                        </nav>
                    
                </div>
            </div>
        </div> 
        <nav class="navbar navbar-default wh_footer navbar-bottom">
  <div class=" footer-container text-center ">
    <p><span class="footercopyright">© 2019 Guidewire Software, Inc.</span><span class="footerDate">Published November 21, 2019</span></p>
  </div>
</nav>
        
        <div id="go2top">
            <span class="glyphicon glyphicon-chevron-up"></span>
        </div>
        
        <!-- The modal container for images -->
        <div id="modal_img_large" class="modal">
            <span class="close glyphicon glyphicon-remove"></span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="modal-img" />
            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        
        <!-- <script src="${oxygen-webhelp-assets-dir}/lib/bootstrap/js/bootstrap.min.js" type="text/javascript"></script> -->
        
    </body>
</html>